<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DOM结构调试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .info { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .sidebar-elem { background: #ffcccc; border: 2px solid red; }
        .main-elem { background: #ccffcc; border: 2px solid green; }
    </style>
</head>
<body>
    <h1>DOM结构分析工具</h1>
    <div class="info">
        <p>这个页面会分析秘塔AI搜索的DOM结构，帮助我们找到正确的侧边栏选择器。</p>
    </div>
    
    <iframe id="metaso-frame" src="http://localhost:10101" width="100%" height="600" frameborder="1"></iframe>
    
    <div id="analysis" class="info">
        <h3>DOM分析结果：</h3>
        <div id="results"></div>
    </div>
    
    <script>
        setTimeout(() => {
            const frame = document.getElementById('metaso-frame');
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                const results = document.getElementById('results');
                
                // 查找可能的侧边栏元素
                const possibleSidebars = [];
                
                // 检查常见的侧边栏选择器
                const selectors = [
                    'nav', 'aside', '.sidebar', '[class*="sidebar"]', '[class*="nav"]',
                    '[class*="left"]', '[class*="side"]', 'nav[role="navigation"]',
                    '.grid-cols-12 > div:first-child', '.flex > div:first-child'
                ];
                
                selectors.forEach(selector => {
                    try {
                        const elements = frameDoc.querySelectorAll(selector);
                        if (elements.length > 0) {
                            possibleSidebars.push({
                                selector: selector,
                                count: elements.length,
                                elements: Array.from(elements).map(el => ({
                                    tagName: el.tagName,
                                    className: el.className,
                                    id: el.id,
                                    textContent: el.textContent ? el.textContent.slice(0, 100) + '...' : '',
                                    position: window.getComputedStyle(el).position,
                                    width: el.offsetWidth,
                                    height: el.offsetHeight
                                }))
                            });
                        }
                    } catch (e) {
                        console.log('Error with selector:', selector, e);
                    }
                });
                
                // 显示结果
                results.innerHTML = possibleSidebars.map(item => `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                        <strong>选择器: ${item.selector}</strong> (找到 ${item.count} 个元素)<br>
                        ${item.elements.map(el => `
                            <div style="margin: 5px 0; padding: 5px; background: #f9f9f9;">
                                标签: ${el.tagName}<br>
                                类名: ${el.className || '无'}<br>
                                ID: ${el.id || '无'}<br>
                                尺寸: ${el.width}x${el.height}<br>
                                内容预览: ${el.textContent.slice(0, 50)}...
                            </div>
                        `).join('')}
                    </div>
                `).join('');
                
            } catch (e) {
                results.innerHTML = `<p style="color: red;">无法访问iframe内容: ${e.message}</p>`;
            }
        }, 3000);
    </script>
</body>
</html>
