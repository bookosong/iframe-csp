(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96491],{96491:function(e,n,t){"use strict";t.r(n),t.d(n,{CaseMindMapping:function(){return e_},MarkdownMindMap:function(){return eV},MindMappingBox:function(){return eT},MindMappingOutLine:function(){return eZ},SimpleMindMappingBox:function(){return eb},_MindMappingBox:function(){return eH},md2Image:function(){return ek},removeMindMapCache:function(){return eC},useCaseMindMapping:function(){return eM},useMindMapping:function(){return ej}});var r=t(2403),i=t(2473),a=t(5194),o=t(1780),l=t(50059),s=t(85735),u=t(5853),c=t(57437),d=t(2265),p=t(39207),f=t(22322),h=t(25284),v=t(33118),g=t(55248),m=t.n(g),x=t(52984);t(98131);var w=t(78693),C=t(35389),M=t(90486),y=t(46387),k=t(35791),j=t(59832),b=t(19643),H=t(38398),T=t(42187),_=t(8350),I=t(7870),S=t(29336),Z=t(89574),R=t(63791),D=t(87928),N=t(79778),B=t(20929),L=t(10638),E=t(55833),W=t(36017),F=t(3864),O=t(74634),A=t(81705),V=t(36760),P=t.n(V),J=t(99305),q=t(12),z=t(26058),G=t(40100),$=t(23048),K=t(47812),U=t(36331),Y=t(31219),X=t(23760),Q=t(41963),ee=t(99376),en=t(84054),et=t(89051),er=t(34040),ei=t(5978),ea=t.n(ei),eo=t(89831),el=t(25922),es=t(79943),eu=t(68791),ec=t(81963),ed=t(30166),ep=t(94841),ef=t(48359),eh=t.n(ef),ev=t(54632),eg=t(25590),em=t(71931),ex=(0,ed.default)(function(){return Promise.all([t.e(47999),t.e(37160),t.e(21100),t.e(58509),t.e(13521),t.e(89576),t.e(93316),t.e(56873),t.e(75181),t.e(35322),t.e(63796),t.e(98323),t.e(21602),t.e(3615),t.e(84661)]).then(t.bind(t,10301)).then(function(e){return{default:e.ReferenceNum}})},{loadableGenerated:{webpack:function(){return[10301]}}}),ew=new Map;function eC(){ew.clear()}function eM(e){var n=e.resultId,t=e.searchKey,r=e.links,i=e.gid,a=e.ref,o=(0,l._)((0,d.useState)(null),2),s=o[0],u=o[1];(0,d.useImperativeHandle)(a,function(){return{loadData:function(){return v()}}});var c=t+n,h=(0,es.WS)(),v=function(){return new Promise(function(e,a){if(ew.has(c)){u(ew.get(c)),e(ew.get(c).markdownTextAfterHandle);return}(0,p.DrM)(n,t).then(function(n){if(404!==n.data.errCode){if(n.data.errCode===eo.cO.SENSITIVE_WORD){(0,f.y)("本次请求涉及的领域暂不支持",{variant:"warning",autoHideDuration:3e3,keep:!0}),(0,I.mh)(h);return}var t=eD(n.data.data,r,i);ew.set(c,t),u(t),e(t.markdownTextAfterHandle)}}).catch(function(e){(0,f.y)("当前高峰期，为了确保每位用户都能享受最佳体验，建议您稍后再用~",{variant:"warning",autoHideDuration:5e3}),a(e),(0,I.dW)(I.Gy.MIND_MAPPING_REQUEST_ERROR,{param:{resultId:n,searchKey:t},client:(0,z.Fk)(),error:e?e.stack?e.stack.toString():e.message:"error null"})})})};return{mindMapResult:s,loadData:v}}var ey=function(e){var n=e.md;e.cb;var t=(0,d.useRef)(null),i=(0,d.useRef)();(0,d.useEffect)(function(){var e=v.v$.create(t.current);return i.current=e,e.setData(eF.transform(" ").root),function(){i.current&&i.current.destroy()}},[]);var a=(0,d.useCallback)(function(e){var n=i.current;if(n){var t=eF.transform(e).root;n.setData(t),p()}},[i.current]),o=(0,d.useRef)(null);(0,d.useEffect)(function(){n.indexOf("$")>=0?(o.current&&clearTimeout(o.current),a(n),o.current=setTimeout(function(){a(n)},500)):a(n)},[i.current,n]);var l=(0,el.F)().theme,s=(0,d.useRef)(!1);(0,d.useEffect)(function(){s.current&&new Promise((0,r._)(function(){var e,n,r,i,a,o,l,s,c,d,p,f,h,v,g,m;return(0,u.Jh)(this,function(u){switch(u.label){case 0:if(!((a=t.current)&&((null===(r=window)||void 0===r?void 0:null===(n=r.webkit)||void 0===n?void 0:null===(e=n.messageHandlers)||void 0===e?void 0:e.nativeHandler)||(null===(i=window)||void 0===i?void 0:i.nativeHandler)||"undefined"!=typeof hm&&hm)))return[3,2];return d=window.innerHeight,p=window.innerWidth,[4,(0,x.YM)(a,{canvasWidth:p,canvasHeight:d})];case 1:if(!(f=u.sent()))return[2];(null===(s=window)||void 0===s?void 0:null===(l=s.webkit)||void 0===l?void 0:null===(o=l.messageHandlers)||void 0===o?void 0:o.nativeHandler)&&(null===(m=window)||void 0===m||null===(g=m.webkit)||void 0===g||null===(v=g.messageHandlers)||void 0===v||null===(h=v.nativeHandler)||void 0===h||h.postMessage(JSON.stringify({type:"mindImageBase64",value:f}))),"undefined"!=typeof hm&&hm&&hm.setMindImageBase64(f),(null===(c=window)||void 0===c?void 0:c.nativeHandler)&&window.nativeHandler.postMessage(JSON.stringify({type:"mindImageBase64",value:f})),u.label=2;case 2:return[2]}})}))},[l]);var p=(0,d.useCallback)((0,r._)(function(){var e,n,r,a,o,l,c,d,p,f,h,v,g,m,w,C,M;return(0,u.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),[4,null===(e=i.current)||void 0===e?void 0:e.fit()];case 1:if(u.sent(),!(l=t.current))return[2];c=window.innerHeight,d=window.innerWidth;try{d=t.current.width.baseVal.value*(c/t.current.height.baseVal.value)}catch(e){}if(!((null===(a=window)||void 0===a?void 0:null===(r=a.webkit)||void 0===r?void 0:null===(n=r.messageHandlers)||void 0===n?void 0:n.nativeHandler)||"undefined"!=typeof hm&&hm||(null===(o=window)||void 0===o?void 0:o.nativeHandler)))return[3,3];return[4,(0,x.YM)(l,{canvasWidth:d,canvasHeight:c,pixelRatio:1,quality:.8})];case 2:g=u.sent(),(null===(h=window)||void 0===h?void 0:null===(f=h.webkit)||void 0===f?void 0:null===(p=f.messageHandlers)||void 0===p?void 0:p.nativeHandler)&&(null===(M=window)||void 0===M||null===(C=M.webkit)||void 0===C||null===(w=C.messageHandlers)||void 0===w||null===(m=w.nativeHandler)||void 0===m||m.postMessage(JSON.stringify({type:"mindImageBase64",value:g}))),"undefined"!=typeof hm&&hm&&hm.setMindImageBase64(g),(null===(v=window)||void 0===v?void 0:v.nativeHandler)&&window.nativeHandler.postMessage(JSON.stringify({type:"mindImageBase64",value:g})),s.current=!0,u.label=3;case 3:return[3,5];case 4:return u.sent(),[3,5];case 5:return[2]}})}),[]);return(0,c.jsx)("svg",{style:{flex:"1 1",backgroundColor:"white",width:"100%"},ref:t,xmlns:"http://www.w3.org/2000/svg"})};function ek(e){return new Promise(function(n,t){if(!e){n();return}var r="MindMapImageTemp",i=document.getElementById(r);i&&i.remove();var a=document.createElement("div");a.id=r,a.style.position="fixed",a.style.left=-window.innerWidth+"px",a.style.top=window.innerHeight+"px",document.body.appendChild(a);var o=(0,er.createRoot)(a);o.render((0,c.jsx)(ey,{md:e,cb:function(e){o.unmount(),a.remove(),n(e)}}))})}function ej(e){var n,t,r=e.resultId,i=e.links,a=e.onLoad,o=e.queryString,s=e.searchResultId,u=(0,l._)((0,d.useState)(!0),2),c=u[0],h=u[1],v=(0,d.useRef)(null),g=(0,l._)((n=e.tabName,[(t=(0,l._)((0,O.U8)(n,localStorage.getItem("rightToolTabDefaultTab")||ec.R_.tabName,{isControlled:!1}),2))[0],t[1]]),2),m=g[0],x=g[1],w=(0,d.useMemo)(function(){return ec.fG[m].caseMapMode},[m]),C=(0,O.fl)(),M=(0,d.useMemo)(function(){return localStorage.setItem("rightToolTabDefaultTab",m),ec.fG[m].title},[m]);(0,d.useEffect)(function(){var n;C.current&&(null===(n=e.onTabChanged)||void 0===n||n.call(e,m))},[m]);var y=(0,l._)((0,d.useState)(!0),2),k=y[0],j=y[1];return(0,d.useEffect)(function(){r&&((0,d.startTransition)(function(){h(!0)}),v.current.loadData().then(function(e){j(!e)}).catch(function(e){var n=w===ec.SF.Chart?"抽取思维导图数据失败":"抽取大纲数据失败";(0,f.y)(n,{variant:"error",autoHideDuration:5e3}),(0,I.dW)(I.Gy.MIND_MAPPING_LOAD_DATA_ERROR,{param:{resultId:r},client:(0,z.Fk)(),error:e?e.stack?e.stack.toString():e.message:"error null"})}).finally(function(){h(!1),null==a||a()}))},[r]),(0,d.useEffect)(function(){c||(0,p.Bot)(r).then(function(n){n.data.data&&e.setPptPageNum(n.data.data)})},[r,c]),{resultId:r,queryString:o,links:i,loading:c,caseMindMappingRef:v,currentTabName:m,setCurrentTabName:x,CaseMindMappingMode:w,tabTitle:M,noMindMappingResult:k,searchResultId:s}}var eb=function(e){var n=ej(e),t=n.resultId,r=n.queryString,i=(n.searchResultId,n.links),a=(n.loading,n.caseMindMappingRef),o=(n.currentTabName,n.setCurrentTabName,n.CaseMindMappingMode);n.tabTitle,n.noMindMappingResult;var s=(0,l._)((0,d.useState)(!1),2);return s[0],s[1],(0,d.useRef)(null),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(w.Z,{display:"flex",sx:{minHeight:"inherit",height:"inherit",border:"2px solid var(--border-color)",borderTop:"none",position:"relative",padding:"25px 15px 0px",paddingBottom:"".concat(o===ec.SF.Chart?"45px":0)},children:(0,c.jsx)(w.Z,{display:"flex",flex:"1 1 0%",overflow:"scroll",children:(0,c.jsx)(e_,{gid:e.gid,ref:a,resultId:t,searchKey:"1",mode:o,collapse:e.collapse,isH5:e.isH5,queryString:r,engineType:e.engineType,searchTopicId:e.searchTopicId,links:i,searchResultId:e.searchResultId})})})})},eH=function(e){var n=ej(e),t=n.resultId,r=n.queryString,i=n.links,a=n.loading,o=n.caseMindMappingRef,s=n.currentTabName,u=n.setCurrentTabName,p=n.CaseMindMappingMode,f=n.tabTitle,h=n.noMindMappingResult,v=(0,l._)((0,d.useState)(!1),2);v[0],v[1],(0,d.useRef)(null);var g=E.vs.useBridge("resultAPI");(0,d.useEffect)(function(){},[e.pptPageNum]);var m=e.onMindMapChange;return(0,d.useEffect)(function(){m&&m(s)},[s]),(0,c.jsx)(ep.K,{show:!h,sx:e.sx,children:(0,c.jsxs)(w.Z,{children:[!e.isH5&&(0,c.jsxs)(w.Z,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",sx:{p:"14px 15px",borderBottom:"2px solid var(--border-color)"},children:[(0,c.jsxs)(w.Z,{display:"flex",flexDirection:"row",sx:{flex:1},children:[(0,c.jsx)(w.Z,{className:P()(eh().rightToolTabTitle,eh().centerBox),children:f}),(0,c.jsxs)(w.Z,{className:eh().rightToolMenuItemContainer,sx:{marginLeft:"25px"},children:[(0,c.jsx)(ev.Z,{onClick:function(){u(ec.DR.MindMappingChart),(0,I.oh)("mapping-chart")},className:P()(eh().rightToolMenuItem,s===ec.DR.MindMappingChart?eh().active:""),children:(0,c.jsx)("svg",{width:"21",height:"20",viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("g",{id:"git-branch-01",children:(0,c.jsx)("path",{id:"Icon",d:"M3 2.5V11C3 12.4001 3 13.1002 3.27248 13.635C3.51217 14.1054 3.89462 14.4878 4.36502 14.7275C4.8998 15 5.59987 15 7 15H13M13 15C13 16.3807 14.1193 17.5 15.5 17.5C16.8807 17.5 18 16.3807 18 15C18 13.6193 16.8807 12.5 15.5 12.5C14.1193 12.5 13 13.6193 13 15ZM3 6.66667L13 6.66667M13 6.66667C13 8.04738 14.1193 9.16667 15.5 9.16667C16.8807 9.16667 18 8.04738 18 6.66667C18 5.28595 16.8807 4.16667 15.5 4.16667C14.1193 4.16667 13 5.28596 13 6.66667Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),(0,c.jsx)(w.Z,{className:eh().divider}),(0,c.jsx)(ev.Z,{onClick:function(){u(ec.DR.MindMappingOutline),(0,I.oh)("mapping-outline")},className:P()(eh().rightToolMenuItem,s===ec.DR.MindMappingOutline?eh().active:""),children:(0,c.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M17.5 9.99999L7.5 9.99999M17.5 4.99999L7.5 4.99999M17.5 15L7.5 15M4.16667 9.99999C4.16667 10.4602 3.79357 10.8333 3.33333 10.8333C2.8731 10.8333 2.5 10.4602 2.5 9.99999C2.5 9.53975 2.8731 9.16666 3.33333 9.16666C3.79357 9.16666 4.16667 9.53975 4.16667 9.99999ZM4.16667 4.99999C4.16667 5.46023 3.79357 5.83332 3.33333 5.83332C2.8731 5.83332 2.5 5.46023 2.5 4.99999C2.5 4.53975 2.8731 4.16666 3.33333 4.16666C3.79357 4.16666 4.16667 4.53975 4.16667 4.99999ZM4.16667 15C4.16667 15.4602 3.79357 15.8333 3.33333 15.8333C2.8731 15.8333 2.5 15.4602 2.5 15C2.5 14.5398 2.8731 14.1667 3.33333 14.1667C3.79357 14.1667 4.16667 14.5398 4.16667 15Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),(0,c.jsx)(eg.P,{sx:{color:"var(--black)"},onClick:function(){var e;null===(e=g.current)||void 0===e||e.hideMind()},placeStrategy:"static"})]}),(0,c.jsx)(ep.K,{className:"mind-mapping-box-action",show:a,display:"flex",justifyContent:"center",alignItems:"center",width:"calc(100% - 30px)",minHeight:"354px",position:"relative",sx:{padding:"25px 15px"},children:(0,c.jsx)(C.Z,{size:"1.5em",sx:{color:"gray"},thickness:2})}),(0,c.jsx)(ep.K,{className:"mind-mapping-box-action",show:!a,display:"flex",minWidth:"260px",minHeight:"354px",position:"relative",sx:{padding:e.isH5?"5px 0":"25px 15px",paddingBottom:s===ec.DR.MindMappingChart?"45px":"25px"},children:(0,c.jsx)(ep.K,{display:"flex",flex:"1 1",className:"case-mind-mapping-container",show:s===ec.DR.MindMappingChart||s===ec.DR.MindMappingOutline,children:(0,c.jsx)(e_,{gid:e.gid,searchResultId:e.searchResultId,ref:o,resultId:t,searchKey:"1",mode:p,collapse:e.collapse,isH5:e.isH5,queryString:r,engineType:e.engineType,searchTopicId:e.searchTopicId,links:i})})})]})})},eT=d.memo(eH),e_=(0,d.forwardRef)(function(e,n){var t=e.mode,r=e.links,i=eM((0,o._)((0,a._)({},e),{ref:n})).mindMapResult,s=(0,l._)((0,d.useState)(""),2),u=s[0],p=s[1],f=new Map;(0,d.useEffect)(function(){var n,t=null==i?void 0:i.mindMap.replace(/\[\[(\d+)\]\]/g,"");null===(n=h.current)||void 0===n||n.setMindMapMd(e.resultId,t),!t||f.has(t)||ek(t).then(function(e){e&&(f.set(ea().hash(t),e),p("<!-- TOC -->\n\n## 脑图\n\n"+"![](".concat(e,")")))}).catch(function(e){})},[i]);var h=E.vs.useBridge("exportMarkdownAPI"),v=(0,em.y1)(function(n){var t;null===(t=h.current)||void 0===t||t.updateExportMarkdownTextMap(E.r$.MindMap,e.resultId,n)},500);return(0,d.useEffect)(function(){v(u)},[u]),(0,c.jsxs)(c.Fragment,{children:[i&&t===ec.SF.Chart&&(0,c.jsx)(eV,{isH5:e.isH5,collapse:e.collapse,originData:{mindMap:i.mindMap,links:e.links,gid:e.gid},markdownText:i.markdownTextAfterHandle}),!e.collapse&&i&&t===ec.SF.Outline&&(0,c.jsx)(M.Z,{in:!e.collapse&&i&&t===ec.SF.Outline,timeout:1e3,children:(0,c.jsx)(w.Z,{children:(0,c.jsx)(eZ,{gid:e.gid,isH5:e.isH5,tree:i.treeNode,links:r,queryString:e.queryString,engineType:e.engineType,searchTopicId:e.searchTopicId,searchResultId:e.searchResultId})})})]})});e_.displayName="CaseMindMapping";var eI=function(){function e(n,t,r,a,o,l){(0,i._)(this,e),this.id=n,this.originText=t,this.referenceNums=r,this.val=a,this.level=o,this.children=l}return e.prototype.pushChild=function(e){this.children.push(e),e.parent=this},e}(),eS=function(e){var n=function(e){var n=e.split("\n"),t=[],r=!0,i=!1,a=void 0;try{for(var o,l=n[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var s=o.value,u=s.trim();u.startsWith("#")||u.startsWith("-")||0==t.length?t.push(s):t[t.length-1]+="\n"+s}}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return t}(e),t=new eI("-1","",[],"",-1,[]);if(n.length>1&&n[0].startsWith("# ")){var r=n[0];n=n.slice(1);var i=r.indexOf("- ")+1,a=eW(r.substring(i+1));t=new eI("-1",r,a.referenceNums,a.textAfterFilter,-1,[])}var o=new Map;o.set(t.level,t);for(var l=n.length,s=0;s<l;s++){for(var u=n[s],c=function(e){var n,t,r=e.indexOf("- ");r<0?(n=0,t=e):(n=0==r?1:Math.floor((r+1)/2),t=e.substring(r+2));var i=eW(t);return{referenceNums:i.referenceNums,textAfterFilter:i.textAfterFilter,level:n}}(u),d=c.referenceNums,f=c.textAfterFilter,h=c.level,v=new eI((0,p.DOL)(),u,d,f,h,[]),g=h-1;!o.has(g)&&g>-1;)g--;g>=-1&&(o.get(g).pushChild(v),o.set(v.level,v))}return t},eZ=function(e){var n=e.tree,t=e.links,r=e.queryString,i=(0,l._)((0,d.useState)(""),2),a=i[0],o=i[1],s=(0,l._)((0,d.useState)([]),2),u=s[0],f=s[1],h=!n||!n.val||0===n.val.trim().length;(0,d.useEffect)(function(){(0,d.startTransition)(function(){o(n.val);var e=n.referenceNums.map(function(e){return{index:e-1,link:t[e-1]}});f((0,F._p)(e))})},[n.val,n.id]);var v=(0,es.WS)(),g=function(n,t){n.stopPropagation(),n.preventDefault();var i,a=[];for((0,I.oh)("click-mapping-outLine");t;){var o=document.getElementById("outline"+t.id),l=o?o.innerText:function(e){var n=e.replace(/^#+\s+(.*)$/gm,"$1");return(n=(n=(n=(n=(n=(n=n.replace(/^(\s*[-*]\s+)(.*)$/gm,"$2")).replace(/[_*]{1,3}(.+?)[_*]{1,3}/g,"$1")).replace(/\[([^\]]+)\]\(([^\)]+)\)/g,"$1 ($2)")).replace(/!\[([^\]]+)\]\(([^\)]+)\)/g,"")).replace(/```[\s\S]*?```/g,"")).replace(/`(.+?)`/g,"$1")).trim()}(t.val);a.unshift(l),t=t.parent}var s=r||a[0],u=a.slice(1),c=(0,p.Cmf)((0,E.G2)({question:s,mode:"detail",engineType:e.engineType,searchTopicId:e.engineType==K.rG.KNOWLEDGE?e.searchTopicId:null,searchType:void 0,path:u}));(null===(i=(0,z.ZD)())||void 0===i?void 0:i.isMiniWebView)?v.push(c):e.isH5?v.push(c):window.open(c)},x=(0,d.useMemo)(function(){return(0,c.jsx)(w.Z,{component:"span",sx:{height:"22px",overflow:"hidden"},className:P()(m().outLineNumContainer),children:u.map(function(n,t){return(0,c.jsx)(ex,{searchResultId:e.searchResultId,from:F.ik.Mapping,targetId:n.link.file_meta?"reference-"+e.gid+"-"+n.link.display.refer_id:void 0,pages:n.pages,index:n.num,rid:1e4+(n.link.display?n.link.display.refer_id-1:n.num-1),engineType:e.engineType,isH5:e.isH5,gid:e.gid,num:n.link.display.refer_id,link:n.link},n.num)})})},[e.engineType,e.gid,u,e.links]);return n?(0,c.jsxs)(w.Z,{display:"flex",flexDirection:"column",paddingLeft:n.level>0?"12px":"0",sx:{wordBreak:"break-all"},margin:"1px 0",children:[n.level>=0&&!h&&(0,c.jsxs)(w.Z,{display:"flex",className:"case-mind-mapping-content-prefix",flexDirection:"row",sx:{lineHeight:"22px",fontSize:"14px",fontWeight:"400"},children:[n.level>0&&(0,c.jsx)(w.Z,{sx:{mr:1.25},children:(0,c.jsx)(S.Z,{style:{color:"var(--content-op-color)"}})}),(0,c.jsxs)(w.Z,{component:"span",className:P()(m().outLineContent,"case-mind-mapping-content"),children:[(0,c.jsx)(w.Z,{component:"span",className:m().outLineMarkdownContainer,onClick:function(e){return g(e,n)},children:(0,c.jsx)(eR,{content:a})}),x]})]}),n.children&&(0,c.jsx)(w.Z,{paddingLeft:n.level>0?"4px":"0",children:(0,c.jsx)(w.Z,{borderLeft:n.level>0?"1px solid #EAECF0":"none",children:n.children.map(function(n){return(0,c.jsx)(eZ,{gid:e.gid,isH5:e.isH5,tree:n,links:t,queryString:r,engineType:e.engineType,searchTopicId:e.searchTopicId,searchResultId:e.searchResultId},n.id)})})})]}):(0,c.jsx)(c.Fragment,{})};function eR(e){var n=(0,I.BL)((0,I.tk)(e.content));return(0,c.jsx)(eu.s,{remarkPlugins:[Z.Z,R.Z,D.Z],rehypePlugins:[N.Z,[B.Z,{detect:!1,ignoreMissing:!0}],L.Z],components:{pre:function(e){return(0,c.jsx)("span",{children:e.children})}},skipHtml:!0,children:n})}var eD=function(e,n,t){var r=eS(e);eN(r,n);var i=eB(r,n,t);return{treeNode:r,markdownTextAfterHandle:i,mindMap:e}},eN=function(e,n){e.originText;var t=n.length,r=[],i=!1,a=!0,o=!1,l=void 0;try{for(var s,u=e.referenceNums[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var c=s.value;c<=t?(c>0&&c<=n.length&&n[c-1].danger&&(e.danger=!0),r.push(c)):i=!0}}catch(e){o=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw l}}e.referenceNums=r,i&&(0,I.dW)(I.Gy.MindMappingReferenceError,{node:e.originText,links:n}).catch(function(e){});var d=e.children.length,p=!0,f=!1,h=void 0;try{for(var v,g=e.children[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;eN(m,n)}}catch(e){f=!0,h=e}finally{try{p||null==g.return||g.return()}finally{if(f)throw h}}e.children=e.children.filter(function(e){return!e.danger}),0==e.children.length&&0!=d&&(e.danger=!0)},eB=function(e,n,t){if(!e.children||0==e.children.length)return eL(e,n,t);var r=eL(e,n,t)+"\n";return -1==e.level&&(r=""),r+e.children.map(function(e){return eB(e,n,t)}).join("\n")},eL=function(e,n,t){var r=e.originText.replace(/\[(\[\d+])+]/g,""),i=new Set,a=[];return e.referenceNums.forEach(function(e){n[e-1].display?i.has(n[e-1].display.refer_id)||(a.push(e),i.add(n[e-1].display.refer_id)):a.push(e)}),r.trim()+a.filter(function(e){return e>0&&e<=n.length}).map(function(e){return eE(e,n[e-1],t)}).join("")},eE=function(e,n,t){return'<a href="'.concat(n.file_meta&&n.file_meta?"#reference-".concat(t,"-").concat(n.display.refer_id):n.link,'" target="_blank" class="').concat(m().mindMappingReferenceDot,'">').concat(n.display?n.display.refer_id:e,"</a>")},eW=function(e){var n=[],t=e.replace(/\[(\[\d+])+]/g,function(e){var t=e.match(/\[(\d+)]/g);return t&&n.push.apply(n,(0,s._)(t.map(function(e){return parseInt(e.substring(1,e.length-1))}))),""});return{referenceNums:n,textAfterFilter:t}},eF=new h.$T((0,s._)(h.Y4)),eO=(0,d.forwardRef)(function(e,n){var t,i,a=e.originData,o=e.markdownText,s=e.fullScreenClicked,p=e.showToolBar,h=e.hideFullScreenButton,g=e.hideDownloadButton,w=e.toolBarSx,M=e.handleClose,k=(0,d.useRef)(null),j=(0,d.useRef)(),b=(0,d.useRef)(!1),H=(0,l._)((0,d.useState)(!1),2),T=H[0],_=H[1],S=(0,l._)((0,d.useState)(""),2),Z=S[0],R=S[1];(0,d.useImperativeHandle)(n,function(){return{fit:function(){D()},download:function(){X()}}},[]);var D=(0,d.useCallback)((0,r._)(function(){var e;return(0,u.Jh)(this,function(n){switch(n.label){case 0:if(b.current)return[2];b.current=!0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,null===(e=j.current)||void 0===e?void 0:e.fit()];case 2:return n.sent(),[3,4];case 3:return n.sent(),(0,I.dW)("markmap-fit-error",1),[3,4];case 4:return b.current=!1,[2]}})}),[]);(0,d.useEffect)(function(){var e=v.v$.create(k.current);return j.current=e,e.setData(eF.transform(" ").root),function(){j.current&&j.current.destroy()}},[]);var N=(0,l._)((0,d.useState)(null),2),B=N[0],L=N[1],F=(0,d.useCallback)((0,r._)(function(){var e;return(0,u.Jh)(this,function(n){switch(n.label){case 0:if(e=V(),!(j.current&&e!==B))return[3,2];return[4,O()];case 1:n.sent(),n.label=2;case 2:return[2]}})}),[j,B]),O=(0,d.useCallback)((0,r._)(function(){return(0,u.Jh)(this,function(e){switch(e.label){case 0:if(!j.current)return[3,2];return[4,D()];case 1:e.sent(),e.label=2;case 2:return A(),[2]}})}),[]),A=function(){k.current&&L(V())},V=function(){var e=k.current;if(!e)return null;var n=e.querySelector("g");return n?n.getAttribute("transform"):null},P=(0,d.useCallback)(function(e){var n=j.current;if(n){var t=eF.transform(e).root;n.setData(t),setTimeout(function(){O()},1e3)}},[j.current]),K=(0,d.useRef)(null);(0,d.useEffect)(function(){o.indexOf("$")>=0?(K.current&&clearTimeout(K.current),P(o),K.current=setTimeout(function(){P(o)},500)):P(o)},[j.current,o]);var U=(t=(0,r._)(function(){var e,n;return(0,u.Jh)(this,function(t){return k.current?(e=window.innerHeight,n=k.current.width.baseVal.value*(e/k.current.height.baseVal.value),[2,(0,x.SE)(k.current,{canvasWidth:n,canvasHeight:e})]):[2]})}),function(){return t.apply(this,arguments)}),Y=(i=(0,r._)(function(){var e,n;return(0,u.Jh)(this,function(t){switch(t.label){case 0:if(new Date().getTime(),e=V(),!(j.current&&e!==B))return[3,2];return[4,O()];case 1:t.sent(),t.label=2;case 2:return new Date().getTime(),[4,U()];case 3:return n=t.sent(),new Date().getTime(),[2,n]}})}),function(){return i.apply(this,arguments)}),X=(0,d.useCallback)((0,r._)(function(){var e,n,t,i,a,o,l,s,c,d,p,f,h,v,g,w,C,M,y,j,b,H;return(0,u.Jh)(this,function(T){switch(T.label){case 0:null===(e=k.current)||void 0===e||e.classList.add(m().referenceDisplayNone),T.label=1;case 1:if(T.trys.push([1,,7,8]),!((null===(i=window)||void 0===i?void 0:null===(t=i.webkit)||void 0===t?void 0:null===(n=t.messageHandlers)||void 0===n?void 0:n.nativeHandler)||"undefined"!=typeof hm||(null===(a=window)||void 0===a?void 0:a.nativeHandler)||(null===(o=(0,z.ZD)())||void 0===o?void 0:o.isMiniWebView)||(null===(l=(0,z.ZD)())||void 0===l?void 0:l.isAliApp)))return[3,5];return v=!1,[4,F()];case 2:return T.sent(),[4,(0,x.YM)(k.current)];case 3:var I;if(g=T.sent(),I=(0,r._)(function(){return(0,u.Jh)(this,function(e){return _(!0),R(g),[2]})}),w=function(){return I.apply(this,arguments)},(null===(d=window)||void 0===d?void 0:null===(c=d.webkit)||void 0===c?void 0:null===(s=c.messageHandlers)||void 0===s?void 0:s.nativeHandler)?(v=!0,null===(j=window)||void 0===j||null===(y=j.webkit)||void 0===y||null===(M=y.messageHandlers)||void 0===M||null===(C=M.nativeHandler)||void 0===C||C.postMessage(JSON.stringify({type:"imageBase64",value:g}))):(null===(p=window)||void 0===p?void 0:p.nativeHandler)?(v=!0,window.nativeHandler.postMessage(JSON.stringify({type:"imageBase64",value:g}))):"undefined"!=typeof hm&&hm&&(v=!0,hm.setImageBase64(g)),v)return[2];if(!((null===(f=(0,z.ZD)())||void 0===f?void 0:f.isMiniWebView)||(null===(h=(0,z.ZD)())||void 0===h?void 0:h.isAliApp)))return[3,5];return[4,w()];case 4:return T.sent(),[2];case 5:return[4,Y()];case 6:return b=T.sent(),(0,q.saveAs)(b,"脑图.png"),[3,8];case 7:return null===(H=k.current)||void 0===H||H.classList.remove(m().referenceDisplayNone),[7];case 8:return[2]}})}),[Y]),Q=(0,d.useCallback)((0,r._)(function(){var e;return(0,u.Jh)(this,function(n){switch(n.label){case 0:return[4,Y()];case 1:return e=n.sent(),navigator.clipboard.write([new ClipboardItem({"image/png":e})]),(0,f.y)("复制成功",{variant:"success",autoHideDuration:3e3}),[2]}})}),[Y]),ee=E.HK.useAPI("singletonDrawer");return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{style:{flex:"1 1",backgroundColor:"white",width:"100%"},ref:k,xmlns:"http://www.w3.org/2000/svg",onClick:function(e){if(e.target instanceof HTMLAnchorElement){if(e.target.href.indexOf("#reference")>-1){var n,t,r,i,a,o,l,s,u,c,d=e.target.href.substring(e.target.href.indexOf("#reference")+1),p=document.getElementById(d);M&&M(),(null===(r=window)||void 0===r?void 0:null===(t=r.webkit)||void 0===t?void 0:null===(n=t.messageHandlers)||void 0===n?void 0:n.nativeHandler)?null===(c=window)||void 0===c||null===(u=c.webkit)||void 0===u||null===(s=u.messageHandlers)||void 0===s||null===(l=s.nativeHandler)||void 0===l||l.postMessage(JSON.stringify({type:"pdfReferenceClick",value:d})):(null===(i=window)||void 0===i?void 0:i.nativeHandler)?window.nativeHandler.postMessage(JSON.stringify({type:"pdfReferenceClick",value:d})):"undefined"!=typeof hm&&hm&&hm.onPdfReferenceClick(d),null==p||null===(a=p.querySelector("a"))||void 0===a||a.click(),null===(o=ee.current)||void 0===o||o.toggleOpen(!1),e.preventDefault();return}(0,W.recordReferenceJump)(e.target.href),(0,J.Uq)(e.target.href,e.currentTarget.parentElement)&&e.preventDefault()}}}),p&&(0,c.jsx)(eP,{originData:a,sx:w,fullScreenClicked:s,downloadImage:X,copyImage:Q,hideDownloadButton:g,hideFullScreenButton:h}),(0,c.jsx)(G.k,{open:T,onClose:function(){return _(!1)},maskSx:{zIndex:"30001 !important"},children:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)($.K,{sx:{width:"min(300px, 80vw)",minHeight:350},children:Z?(0,c.jsx)("img",{style:{width:"100%"},src:Z}):(0,c.jsx)(C.Z,{size:"1.5em",sx:{color:"gray"},thickness:2})}),(0,c.jsx)(y.Z,{textAlign:"center",children:"请长按上方图片手动保存"})]})})]})});eO.displayName="_MarkdownMindMap";var eA=d.forwardRef(function(e,n){return(0,c.jsx)(M.Z,(0,a._)({ref:n},e))}),eV=function(e){var n=e.markdownText,t=e.originData,r=e.collapse,i=e.isH5,a=(0,d.useRef)(null),o=(0,d.useRef)(null),s=(0,l._)((0,d.useState)(!1),2),u=s[0],p=s[1],f=(0,O.F)(),h=function(){var e;p(!1),null===(e=a.current)||void 0===e||e.fit()};return(0,d.useEffect)(function(){i||r||setTimeout(function(){var e;null===(e=o.current)||void 0===e||e.fit()},100)},[r,i]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(eO,{ref:o,originData:t,markdownText:n,fullScreenClicked:function(){p(!0)},showToolBar:!0,hideFullScreenButton:f}),!f&&(0,c.jsxs)(k.Z,{fullScreen:!0,keepMounted:!0,open:u,onClose:h,TransitionComponent:eA,sx:{"& .MuiBackdrop-root":{backgroundColor:"transparent"}},children:[(0,c.jsxs)(w.Z,{display:"flex",justifyContent:"space-between",p:"5px 10px",children:[(0,c.jsx)(w.Z,{}),(0,c.jsx)(j.Z,{edge:"start",color:"inherit",onClick:h,"aria-label":"close",children:(0,c.jsx)(A.Z,{})})]}),(0,c.jsx)(eO,{handleClose:h,originData:t,ref:a,markdownText:n,showToolBar:!0,hideFullScreenButton:!0,toolBarSx:{right:"22px!important"}})]})]})},eP=function(e){var n=e.hideDownloadButton,t=e.hideFullScreenButton,r=e.fullScreenClicked,i=e.downloadImage,a=e.copyImage,o=e.originData,s=e.sx,u=(0,l._)((0,d.useState)(!1),2),h=u[0],v=u[1],g=(0,l._)((0,d.useState)(!1),2),x=g[0],M=g[1],y=(0,d.useRef)(null),k=(0,O.F)(),S=(0,X.LM)(),Z=(0,d.useRef)(!1),R=(0,Q.A8)().removeUrlCmd,D=(0,ee.useSearchParams)(),N=(0,d.useCallback)(function(e){M(e)},[]);(0,d.useEffect)(function(){S.hasHydrated&&!t&&E()},[D,S.hasHydrated]);var B=(0,d.useCallback)(function(){Z.current||(Z.current=!0,v(!0),(0,p.fLr)(o.mindMap.split("\n")[0].replace("# ",""),o.mindMap,o.links).then(function(e){v(!1),Z.current=!1,window.open(e.data.data+"?exp=true")}))},[]),L=function(){if(!S.login){if(Z.current)return;Z.current=!0,v(!0);var e=o.mindMap,n=o.mindMap.split("\n")[0].replace("# ","");(0,I.dW)(I.Gy.ExportToXiezuocat,{title:n,md:e,type:"mindMap"}),(0,p.Dvu)(n,e,"mindMap").then(function(e){0===e.data.errCode?window.open(e.data.data):((0,f.y)("导出到写作猫失败",{variant:"error",autoHideDuration:2e3}),(0,I.dW)(I.Gy.ExportToXiezuocatFailed,1))}).catch(function(e){(0,f.y)("导出到写作猫失败",{variant:"error",autoHideDuration:2e3}),(0,I.dW)(I.Gy.ExportToXiezuocatFailed,1)}).finally(function(){v(!1),Z.current=!1});return}B()},E=(0,Q.Qv)(function(e,n){var t;y.current&&e.find(function(e){return e.type===Y.a.ExportMind})&&D.get("gid")==o.gid&&(null===(t=y.current)||void 0===t||t.scrollIntoView({block:"center"}),setTimeout(function(){B()},500),setTimeout(function(){R(Y.a.ExportMind)},100))},{deps:[B]});return(0,c.jsxs)(w.Z,{className:m().toolBar,sx:s,children:[!t&&(0,c.jsx)(j.Z,{className:m().toolBarItem,onClick:r,children:(0,c.jsx)("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M6 1.8562H5.8C4.11984 1.8562 3.27976 1.8562 2.63803 2.18318C2.07354 2.4708 1.6146 2.92974 1.32698 3.49423C1 4.13596 1 4.97604 1 6.6562V6.8562M6 19.8562H5.8C4.11984 19.8562 3.27976 19.8562 2.63803 19.5292C2.07354 19.2416 1.6146 18.7827 1.32698 18.2182C1 17.5764 1 16.7364 1 15.0562V14.8562M19 6.8562V6.6562C19 4.97604 19 4.13596 18.673 3.49423C18.3854 2.92974 17.9265 2.4708 17.362 2.18318C16.7202 1.8562 15.8802 1.8562 14.2 1.8562H14M19 14.8562V15.0562C19 16.7364 19 17.5764 18.673 18.2182C18.3854 18.7827 17.9265 19.2416 17.362 19.5292C16.7202 19.8562 15.8802 19.8562 14.2 19.8562H14",stroke:"#98A2B3",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),!n&&k?(0,c.jsx)(j.Z,{sx:{color:"var(--content-op-color)"},onClick:function(){i&&i()},children:(0,c.jsx)(en.Z,{})}):t?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(b.Z,{direction:"row",alignItems:"center",spacing:3,children:[(0,c.jsx)(et.Z,{title:"下载图片",classes:{tooltip:"custom-tooltip-popper",arrow:"custom-tooltip-arrow"},arrow:!0,children:(0,c.jsx)(j.Z,{sx:{color:"var(--content-op-color)"},onClick:i,children:(0,c.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M16.5 16.5H1.5M14 8.16667L9 13.1667M9 13.1667L4 8.16667M9 13.1667V1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),(0,c.jsx)(et.Z,{title:"复制图片",classes:{tooltip:"custom-tooltip-popper",arrow:"custom-tooltip-arrow"},arrow:!0,children:(0,c.jsx)(j.Z,{sx:{color:"var(--content-op-color)"},onClick:a,children:(0,c.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M13.3332 13.3337V15.667C13.3332 16.6004 13.3332 17.0671 13.1515 17.4236C12.9917 17.7372 12.7368 17.9922 12.4232 18.152C12.0666 18.3337 11.5999 18.3337 10.6665 18.3337H4.33317C3.39975 18.3337 2.93304 18.3337 2.57652 18.152C2.26292 17.9922 2.00795 17.7372 1.84816 17.4236C1.6665 17.0671 1.6665 16.6004 1.6665 15.667V9.33366C1.6665 8.40024 1.6665 7.93353 1.84816 7.57701C2.00795 7.2634 2.26292 7.00844 2.57652 6.84865C2.93304 6.66699 3.39975 6.66699 4.33317 6.66699H6.6665M9.33317 13.3337H15.6665C16.5999 13.3337 17.0666 13.3337 17.4232 13.152C17.7368 12.9922 17.9917 12.7372 18.1515 12.4236C18.3332 12.0671 18.3332 11.6004 18.3332 10.667V4.33366C18.3332 3.40024 18.3332 2.93353 18.1515 2.57701C17.9917 2.2634 17.7368 2.00844 17.4232 1.84865C17.0666 1.66699 16.5999 1.66699 15.6665 1.66699H9.33317C8.39975 1.66699 7.93304 1.66699 7.57652 1.84865C7.26292 2.00844 7.00795 2.2634 6.84816 2.57701C6.6665 2.93353 6.6665 3.40024 6.6665 4.33366V10.667C6.6665 11.6004 6.6665 12.0671 6.84816 12.4236C7.00795 12.7372 7.26292 12.9922 7.57652 13.152C7.93304 13.3337 8.39975 13.3337 9.33317 13.3337Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),(0,c.jsx)(et.Z,{title:"去写作猫编辑",classes:{tooltip:"custom-tooltip-popper",arrow:"custom-tooltip-arrow"},arrow:!0,children:(0,c.jsx)(j.Z,{sx:{color:"var(--content-op-color)"},onClick:L,children:(0,c.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)("path",{d:"M9.1665 3.3332H5.6665C4.26637 3.3332 3.56631 3.3332 3.03153 3.60568C2.56112 3.84536 2.17867 4.22782 1.93899 4.69822C1.6665 5.233 1.6665 5.93307 1.6665 7.3332V14.3332C1.6665 15.7333 1.6665 16.4334 1.93899 16.9682C2.17867 17.4386 2.56112 17.821 3.03153 18.0607C3.56631 18.3332 4.26637 18.3332 5.6665 18.3332H12.6665C14.0666 18.3332 14.7667 18.3332 15.3015 18.0607C15.7719 17.821 16.1543 17.4386 16.394 16.9682C16.6665 16.4334 16.6665 15.7333 16.6665 14.3332V10.8332M6.66648 13.3332H8.06193C8.46959 13.3332 8.67341 13.3332 8.86522 13.2871C9.03528 13.2463 9.19786 13.179 9.34698 13.0876C9.51517 12.9845 9.6593 12.8404 9.94755 12.5521L17.9165 4.5832C18.6069 3.89284 18.6069 2.77355 17.9165 2.0832C17.2261 1.39284 16.1069 1.39284 15.4165 2.0832L7.44753 10.0521C7.15928 10.3404 7.01515 10.4845 6.91208 10.6527C6.8207 10.8018 6.75336 10.9644 6.71253 11.1345C6.66648 11.3263 6.66648 11.5301 6.66648 11.9378V13.3332Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})]})}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(U.Z,{ref:y,checked:x,sx:{color:"var(--content-op-color)",width:36,height:36,minWidth:0,fontSize:"16px",fontWeight:400},onCheckedChange:N,children:h?(0,c.jsx)(C.Z,{size:"1.5em",sx:{color:"gray"},thickness:2}):(0,c.jsx)(en.Z,{})}),(0,c.jsxs)(H.ZP,{id:"export-type",open:x,anchorEl:y.current,onClose:function(){M(!1)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[(0,c.jsx)(T.Z,{onClick:function(){M(!1),i&&i()},style:{fontSize:"14px",color:"var(--export-menu-color)"},children:"下载图片"}),!k&&(0,c.jsx)(T.Z,{onClick:function(){M(!1),a&&a()},style:{fontSize:"14px",color:"var(--export-menu-color)"},children:"复制图片"}),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w.Z,{sx:{padding:"0 16px"},children:(0,c.jsx)(_.Z,{sx:{margin:"0"}})}),(0,c.jsx)(T.Z,{onClick:function(){M(!1),L()},style:{fontSize:"14px",color:"var(--export-menu-color)"},children:"去写作猫编辑"})]})]})]})]})}},55248:function(e){e.exports={toolBar:"CaseMindMapping_toolBar__vz_Vu",toolBarItem:"CaseMindMapping_toolBarItem__swsAA",outLineContent:"CaseMindMapping_outLineContent__40wwF",outLineNumContainer:"CaseMindMapping_outLineNumContainer__r8I3F",outLineMarkdownContainer:"CaseMindMapping_outLineMarkdownContainer__8ieZL",mindMappingReferenceDot:"CaseMindMapping_mindMappingReferenceDot__o2IPW",referenceDisplayNone:"CaseMindMapping_referenceDisplayNone__D01qW"}}}]);