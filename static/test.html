<!DOCTYPE html>
<html>
<head>
    <title>IFrame CSP Proxy 测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-case {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        iframe {
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>IFrame CSP Proxy 测试页面</h1>
    
    <div class="test-case">
        <h2>1. 基础 iframe 嵌入测试bing </h2>
        <iframe src="http://localhost:10101/proxy/https://cn.bing.com" 
                width="100%" 
                height="300px"></iframe>
    </div>

    <div class="test-case">
        <h2>1. 基础 iframe 嵌入测试baidu</h2>
        <iframe src="http://localhost:10101/proxy/https://www.baidu.com" 
                width="100%" 
                height="300px"></iframe>
    </div>

    <div class="test-case">
        <h2>2. 动态内容测试</h2>
        <button onclick="testAjax()">测试 AJAX 请求</button>
        <div id="ajax-result"></div>
        <button onclick="testWebSocket()">测试 WebSocket</button>
        <div id="ws-result"></div>
    </div>

    <div class="test-case">
        <h2>3. 表单提交测试</h2>
        <form id="test-form" onsubmit="return testForm(event)">
            <input type="text" name="test-input" value="测试数据">
            <button type="submit">提交表单</button>
        </form>
        <div id="form-result"></div>
    </div>

    <div class="test-case">
        <h2>4. 资源加载测试</h2>
        <img src="http://localhost:10101/proxy/https%3A%2F%2Fpicsum.photos%2F200%2F300" 
             alt="测试图片" width="200">
        <div id="dynamic-image"></div>
        <button onclick="testDynamicLoad()">测试动态加载</button>
    </div>

    <script>
        // AJAX 测试
        async function testAjax() {
            const result = document.getElementById('ajax-result');
            try {
                const response = await fetch('http://localhost:10101/proxy/https%3A%2F%2Fapi.github.com%2Fzen');
                const text = await response.text();
                result.innerHTML = `<p class="success">AJAX 成功: ${text}</p>`;
            } catch (error) {
                result.innerHTML = `<p class="error">AJAX 错误: ${error.message}</p>`;
            }
        }

        // WebSocket 测试
        function testWebSocket() {
            const result = document.getElementById('ws-result');
            try {
                const ws = new WebSocket('wss://localhost:10101/proxy/wss%3A%2F%2Fecho.websocket.org');
                ws.onopen = () => {
                    result.innerHTML = '<p class="success">WebSocket 连接成功</p>';
                    ws.send('测试消息');
                };
                ws.onmessage = (event) => {
                    result.innerHTML += `<p class="success">收到消息: ${event.data}</p>`;
                };
                ws.onerror = (error) => {
                    result.innerHTML = `<p class="error">WebSocket 错误: ${error.message}</p>`;
                };
            } catch (error) {
                result.innerHTML = `<p class="error">WebSocket 错误: ${error.message}</p>`;
            }
        }

        // 表单测试
        function testForm(event) {
            event.preventDefault();
            const result = document.getElementById('form-result');
            const formData = new FormData(event.target);
            
            fetch('http://localhost:10101/proxy/https%3A%2F%2Fhttpbin.org%2Fpost', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                result.innerHTML = `<p class="success">表单提交成功: ${JSON.stringify(data)}</p>`;
            })
            .catch(error => {
                result.innerHTML = `<p class="error">表单提交错误: ${error.message}</p>`;
            });

            return false;
        }

        // 动态资源加载测试
        function testDynamicLoad() {
            const container = document.getElementById('dynamic-image');
            const img = document.createElement('img');
            img.src = `http://localhost:10101/proxy/https%3A%2F%2Fpicsum.photos%2F200%2F300%3Frandom%3D${Date.now()}`;
            img.width = 200;
            img.onload = () => container.appendChild(img);
            img.onerror = (error) => {
                container.innerHTML = `<p class="error">图片加载错误: ${error.message}</p>`;
            };
        }
    </script>
</body>
</html>
