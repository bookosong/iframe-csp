<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾ç¡®æ§åˆ¶è‡ªåŠ¨æœç´¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            background: #dc3545;
            color: white;
            padding: 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 20px;
        }
        
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #17a2b8;
            color: #0c5460;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
        }
        
        .iframe-wrapper {
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
            height: 700px;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        button.success {
            background: #28a745;
        }
        
        button.success:hover:not(:disabled) {
            background: #1e7e34;
        }
        
        button.warning {
            background: #ffc107;
            color: #856404;
        }
        
        button.warning:hover:not(:disabled) {
            background: #e0a800;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        button.danger:hover:not(:disabled) {
            background: #c82333;
        }
        
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-success {
            background: #d4edda;
            color: #155724;
        }
        
        .log-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .log-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .log-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .step-controls {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .step-controls h3 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ç²¾ç¡®æ§åˆ¶è‡ªåŠ¨æœç´¢</h1>
            <p>åˆ†æ­¥éª¤æ‰§è¡Œï¼Œé¿å…è§¦å‘æ„å¤–çš„é¡µé¢é‡å®šå‘</p>
        </div>
        
        <div class="content">
            <div class="error">
                <h3>ğŸš¨ é—®é¢˜åˆ†æ</h3>
                <p>è¾“å…¥"book"åæ–‡æœ¬è¢«æ¸…é™¤ï¼Œé¡µé¢é‡æ–°åˆ·æ–°ï¼Œå¯èƒ½æ˜¯å› ä¸ºï¼š</p>
                <ul>
                    <li>è§¦å‘äº†è¡¨å•æäº¤äº‹ä»¶</li>
                    <li>æ¿€æ´»äº†è‡ªåŠ¨è¡¥å…¨æˆ–å»ºè®®åŠŸèƒ½</li>
                    <li>ReactçŠ¶æ€æ›´æ–°å¯¼è‡´é¡µé¢é‡æ–°æ¸²æŸ“</li>
                    <li>æœç´¢APIè‡ªåŠ¨è°ƒç”¨å¯¼è‡´é¡µé¢è·³è½¬</li>
                </ul>
            </div>
            
            <div class="controls">
                <button onclick="loadPage()" id="loadBtn">åŠ è½½é¡µé¢</button>
                <button onclick="inspectPage()" id="inspectBtn" disabled>æ£€æŸ¥é¡µé¢ç»“æ„</button>
                <button onclick="onlyInput()" id="inputBtn" disabled class="warning">ä»…è¾“å…¥æ–‡æœ¬</button>
                <button onclick="manualSubmit()" id="submitBtn" disabled class="success">æ‰‹åŠ¨æäº¤</button>
                <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
                <button onclick="resetPage()" class="danger">é‡ç½®é¡µé¢</button>
            </div>
            
            <div class="step-controls">
                <h3>ğŸ”§ åˆ†æ­¥æ§åˆ¶</h3>
                <p>å…ˆæ£€æŸ¥é¡µé¢ç»“æ„ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œè¾“å…¥å’Œæäº¤æ“ä½œï¼Œè§‚å¯Ÿæ¯ä¸€æ­¥çš„å½±å“ã€‚</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button onclick="step1FindElements()" id="step1Btn" disabled>1ï¸âƒ£ æŸ¥æ‰¾å…ƒç´ </button>
                    <button onclick="step2PrepareInput()" id="step2Btn" disabled>2ï¸âƒ£ å‡†å¤‡è¾“å…¥</button>
                    <button onclick="step3SetValue()" id="step3Btn" disabled>3ï¸âƒ£ è®¾ç½®å€¼</button>
                    <button onclick="step4TriggerEvents()" id="step4Btn" disabled>4ï¸âƒ£ è§¦å‘äº‹ä»¶</button>
                    <button onclick="step5ClickButton()" id="step5Btn" disabled>5ï¸âƒ£ ç‚¹å‡»æŒ‰é’®</button>
                </div>
            </div>
            
            <div class="iframe-wrapper">
                <iframe id="testFrame" src="about:blank"></iframe>
            </div>
            
            <div class="info">
                <h3>ğŸ“‹ ç²¾ç¡®æ§åˆ¶ç­–ç•¥</h3>
                <ol>
                    <li><strong>é¡µé¢æ£€æŸ¥</strong>ï¼šå…ˆåˆ†æé¡µé¢ç»“æ„å’Œäº‹ä»¶ç»‘å®š</li>
                    <li><strong>ä»…è¾“å…¥</strong>ï¼šåªè®¾ç½®æ–‡æœ¬å€¼ï¼Œä¸è§¦å‘ä»»ä½•äº‹ä»¶</li>
                    <li><strong>äº‹ä»¶æ§åˆ¶</strong>ï¼šæ‰‹åŠ¨æ§åˆ¶ä½•æ—¶è§¦å‘å“ªäº›äº‹ä»¶</li>
                    <li><strong>åˆ†æ­¥æ‰§è¡Œ</strong>ï¼šæ¯æ­¥éƒ½æ£€æŸ¥é¡µé¢çŠ¶æ€å˜åŒ–</li>
                    <li><strong>é˜»æ­¢è‡ªåŠ¨æäº¤</strong>ï¼šé¿å…æ„å¤–çš„è¡¨å•æäº¤</li>
                </ol>
            </div>
            
            <div class="test-results" id="testResults">
                <div class="log-entry log-info">ğŸ“ æ“ä½œæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
            </div>
        </div>
    </div>

    <script>
        let iframeLoaded = false;
        let pageElements = {
            searchBox: null,
            submitButton: null,
            form: null
        };
        let stepData = {};
        
        function addLog(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            logEntry.textContent = `[${timestamp}] ${message}`;
            resultsDiv.appendChild(logEntry);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('testResults').innerHTML = '<div class="log-entry log-info">ğŸ“ æ—¥å¿—å·²æ¸…é™¤</div>';
        }
        
        function updateButtonStates() {
            document.getElementById('inspectBtn').disabled = !iframeLoaded;
            document.getElementById('inputBtn').disabled = !iframeLoaded;
            document.getElementById('submitBtn').disabled = !iframeLoaded;
            document.getElementById('step1Btn').disabled = !iframeLoaded;
        }
        
        function loadPage() {
            addLog('å¼€å§‹åŠ è½½Metaso.cné¡µé¢...', 'info');
            const iframe = document.getElementById('testFrame');
            iframeLoaded = false;
            pageElements = { searchBox: null, submitButton: null, form: null };
            stepData = {};
            
            // é‡ç½®æ‰€æœ‰æ­¥éª¤æŒ‰é’®
            ['step2Btn', 'step3Btn', 'step4Btn', 'step5Btn'].forEach(id => {
                document.getElementById(id).disabled = true;
            });
            
            iframe.onload = function() {
                addLog('âœ… é¡µé¢åŠ è½½å®Œæˆ', 'success');
                iframeLoaded = true;
                updateButtonStates();
                
                setTimeout(() => {
                    addLog('âœ… é¡µé¢å·²ç¨³å®šï¼Œå¯ä»¥å¼€å§‹æ£€æŸ¥', 'success');
                }, 2000);
            };
            
            iframe.onerror = function() {
                addLog('âŒ é¡µé¢åŠ è½½å¤±è´¥', 'error');
                iframeLoaded = false;
                updateButtonStates();
            };
            
            iframe.src = 'http://localhost:10101/';
        }
        
        function resetPage() {
            addLog('ğŸ”„ é‡ç½®é¡µé¢çŠ¶æ€...', 'info');
            const iframe = document.getElementById('testFrame');
            iframe.src = 'about:blank';
            iframeLoaded = false;
            pageElements = { searchBox: null, submitButton: null, form: null };
            stepData = {};
            updateButtonStates();
            
            // é‡ç½®æ‰€æœ‰æ­¥éª¤æŒ‰é’®
            ['step2Btn', 'step3Btn', 'step4Btn', 'step5Btn'].forEach(id => {
                document.getElementById(id).disabled = true;
            });
            
            setTimeout(() => {
                addLog('âœ… é¡µé¢å·²é‡ç½®', 'success');
            }, 1000);
        }
        
        function inspectPage() {
            if (!iframeLoaded) {
                addLog('âŒ é¡µé¢æœªåŠ è½½', 'error');
                return;
            }
            
            addLog('ğŸ” å¼€å§‹æ£€æŸ¥é¡µé¢ç»“æ„...', 'info');
            
            try {
                const iframe = document.getElementById('testFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                if (!iframeDoc) {
                    addLog('âŒ æ— æ³•è®¿é—®iframeå†…å®¹', 'error');
                    return;
                }
                
                // æ£€æŸ¥æœç´¢æ¡†
                const searchSelectors = [
                    'textarea[class*="search-consult-textarea"]',
                    'textarea[placeholder*="æœç´¢"]',
                    'textarea[placeholder*="é—®"]',
                    'textarea',
                    'input[type="text"]'
                ];
                
                let foundSearchBox = false;
                for (const selector of searchSelectors) {
                    const elements = iframeDoc.querySelectorAll(selector);
                    for (const el of elements) {
                        if (el.offsetWidth > 0 && el.offsetHeight > 0) {
                            pageElements.searchBox = el;
                            addLog(`âœ… æ‰¾åˆ°æœç´¢æ¡†: ${selector}`, 'success');
                            addLog(`   - æ ‡ç­¾: ${el.tagName}`, 'info');
                            addLog(`   - ç±»å: ${el.className}`, 'info');
                            addLog(`   - å ä½ç¬¦: ${el.placeholder || 'æ— '}`, 'info');
                            addLog(`   - å½“å‰å€¼: "${el.value}"`, 'info');
                            foundSearchBox = true;
                            break;
                        }
                    }
                    if (foundSearchBox) break;
                }
                
                if (!foundSearchBox) {
                    addLog('âŒ æœªæ‰¾åˆ°æœç´¢æ¡†', 'error');
                }
                
                // æ£€æŸ¥æäº¤æŒ‰é’®
                const buttonSelectors = [
                    'button[class*="send-arrow-button"]',
                    'button[class*="MuiIconButton"]',
                    'button[type="submit"]',
                    'button'
                ];
                
                let foundButton = false;
                for (const selector of buttonSelectors) {
                    const elements = iframeDoc.querySelectorAll(selector);
                    for (const el of elements) {
                        if (el.offsetWidth > 0 && el.offsetHeight > 0) {
                            pageElements.submitButton = el;
                            addLog(`âœ… æ‰¾åˆ°æäº¤æŒ‰é’®: ${selector}`, 'success');
                            addLog(`   - ç±»å: ${el.className}`, 'info');
                            addLog(`   - ç±»å‹: ${el.type || 'æ— '}`, 'info');
                            addLog(`   - æ–‡æœ¬: "${el.textContent.trim()}"`, 'info');
                            foundButton = true;
                            break;
                        }
                    }
                    if (foundButton) break;
                }
                
                if (!foundButton) {
                    addLog('âŒ æœªæ‰¾åˆ°æäº¤æŒ‰é’®', 'error');
                }
                
                // æ£€æŸ¥è¡¨å•
                const forms = iframeDoc.querySelectorAll('form');
                if (forms.length > 0) {
                    pageElements.form = forms[0];
                    addLog(`âœ… æ‰¾åˆ°è¡¨å•: ${forms.length} ä¸ª`, 'success');
                    addLog(`   - åŠ¨ä½œ: ${forms[0].action || 'æ— '}`, 'info');
                    addLog(`   - æ–¹æ³•: ${forms[0].method || 'GET'}`, 'info');
                } else {
                    addLog('âš ï¸ æœªæ‰¾åˆ°è¡¨å•å…ƒç´ ', 'warning');
                }
                
                // æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
                if (pageElements.searchBox) {
                    try {
                        // getEventListeners ä»…åœ¨Chromeå¼€å‘è€…å·¥å…·ä¸­å¯ç”¨
                        const events = (typeof getEventListeners !== 'undefined') ? getEventListeners(pageElements.searchBox) : {};
                        if (Object.keys(events).length > 0) {
                            addLog(`âš ï¸ æœç´¢æ¡†ç»‘å®šäº†äº‹ä»¶: ${Object.keys(events).join(', ')}`, 'warning');
                        } else {
                            addLog('âœ… æœç´¢æ¡†æœªæ£€æµ‹åˆ°äº‹ä»¶ç›‘å¬å™¨', 'success');
                        }
                    } catch (error) {
                        addLog('â„¹ï¸ äº‹ä»¶ç›‘å¬å™¨æ£€æŸ¥è·³è¿‡ï¼ˆéœ€è¦å¼€å‘è€…å·¥å…·ï¼‰', 'info');
                    }
                }
                
                addLog('ğŸ‰ é¡µé¢æ£€æŸ¥å®Œæˆ', 'success');
                
            } catch (error) {
                addLog('âŒ é¡µé¢æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function onlyInput() {
            if (!pageElements.searchBox) {
                addLog('âŒ è¯·å…ˆæ£€æŸ¥é¡µé¢æ‰¾åˆ°æœç´¢æ¡†', 'error');
                return;
            }
            
            addLog('ğŸ“ ä»…è®¾ç½®è¾“å…¥å€¼ï¼Œä¸è§¦å‘ä»»ä½•äº‹ä»¶...', 'info');
            
            try {
                const originalValue = pageElements.searchBox.value;
                addLog(`   - åŸå§‹å€¼: "${originalValue}"`, 'info');
                
                // ä»…è®¾ç½®å€¼ï¼Œä¸è§¦å‘ä»»ä½•äº‹ä»¶
                pageElements.searchBox.value = 'book';
                
                addLog(`   - è®¾ç½®åå€¼: "${pageElements.searchBox.value}"`, 'info');
                addLog('âœ… è¾“å…¥å€¼è®¾ç½®å®Œæˆï¼Œæœªè§¦å‘ä»»ä½•äº‹ä»¶', 'success');
                addLog('ğŸ’¡ è¯·è§‚å¯Ÿé¡µé¢æ˜¯å¦æœ‰å˜åŒ–', 'warning');
                
                // æ£€æŸ¥å€¼æ˜¯å¦è¢«æ¸…é™¤
                setTimeout(() => {
                    if (pageElements.searchBox && pageElements.searchBox.value !== 'book') {
                        addLog(`âŒ å€¼è¢«è‡ªåŠ¨æ¸…é™¤: "${pageElements.searchBox.value}"`, 'error');
                    } else if (pageElements.searchBox) {
                        addLog('âœ… å€¼ä¿æŒç¨³å®š', 'success');
                    }
                }, 1000);
                
            } catch (error) {
                addLog('âŒ è®¾ç½®è¾“å…¥å€¼å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function manualSubmit() {
            if (!pageElements.submitButton) {
                addLog('âŒ è¯·å…ˆæ£€æŸ¥é¡µé¢æ‰¾åˆ°æäº¤æŒ‰é’®', 'error');
                return;
            }
            
            addLog('ğŸ–±ï¸ æ‰‹åŠ¨ç‚¹å‡»æäº¤æŒ‰é’®...', 'info');
            
            try {
                // æ£€æŸ¥å½“å‰æœç´¢æ¡†çš„å€¼
                if (pageElements.searchBox) {
                    addLog(`   - å½“å‰æœç´¢æ¡†å€¼: "${pageElements.searchBox.value}"`, 'info');
                }
                
                // ç‚¹å‡»æŒ‰é’®
                pageElements.submitButton.click();
                addLog('âœ… å·²ç‚¹å‡»æäº¤æŒ‰é’®', 'success');
                
                // ç›‘æµ‹é¡µé¢å˜åŒ–
                setTimeout(() => {
                    addLog('ğŸ” æ£€æŸ¥é¡µé¢å“åº”...', 'info');
                    
                    const iframe = document.getElementById('testFrame');
                    const currentUrl = iframe.contentWindow ? iframe.contentWindow.location.href : 'æ— æ³•è·å–';
                    addLog(`   - å½“å‰URL: ${currentUrl}`, 'info');
                    
                    if (currentUrl.includes('search') || currentUrl.includes('book')) {
                        addLog('âœ… æ£€æµ‹åˆ°æœç´¢ç›¸å…³çš„URLå˜åŒ–', 'success');
                    }
                }, 2000);
                
            } catch (error) {
                addLog('âŒ ç‚¹å‡»æäº¤æŒ‰é’®å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // åˆ†æ­¥æ‰§è¡ŒåŠŸèƒ½
        function step1FindElements() {
            addLog('1ï¸âƒ£ æ­¥éª¤1ï¼šæŸ¥æ‰¾é¡µé¢å…ƒç´ ...', 'info');
            inspectPage();
            
            if (pageElements.searchBox && pageElements.submitButton) {
                document.getElementById('step2Btn').disabled = false;
                addLog('âœ… æ­¥éª¤1å®Œæˆï¼Œå¯ä»¥è¿›è¡Œæ­¥éª¤2', 'success');
            } else {
                addLog('âŒ æ­¥éª¤1å¤±è´¥ï¼Œæ— æ³•ç»§ç»­', 'error');
            }
        }
        
        function step2PrepareInput() {
            addLog('2ï¸âƒ£ æ­¥éª¤2ï¼šå‡†å¤‡è¾“å…¥ï¼ˆèšç„¦å…ƒç´ ï¼‰...', 'info');
            
            try {
                pageElements.searchBox.focus();
                stepData.originalValue = pageElements.searchBox.value;
                addLog(`   - å·²èšç„¦æœç´¢æ¡†`, 'success');
                addLog(`   - åŸå§‹å€¼: "${stepData.originalValue}"`, 'info');
                
                document.getElementById('step3Btn').disabled = false;
                addLog('âœ… æ­¥éª¤2å®Œæˆï¼Œå¯ä»¥è¿›è¡Œæ­¥éª¤3', 'success');
                
            } catch (error) {
                addLog('âŒ æ­¥éª¤2å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function step3SetValue() {
            addLog('3ï¸âƒ£ æ­¥éª¤3ï¼šè®¾ç½®è¾“å…¥å€¼...', 'info');
            
            try {
                pageElements.searchBox.value = 'book';
                addLog(`   - å€¼å·²è®¾ç½®ä¸º: "${pageElements.searchBox.value}"`, 'success');
                
                // ç­‰å¾…æ£€æŸ¥å€¼æ˜¯å¦ç¨³å®š
                setTimeout(() => {
                    if (pageElements.searchBox.value === 'book') {
                        addLog('âœ… å€¼ä¿æŒç¨³å®šï¼Œå¯ä»¥è¿›è¡Œæ­¥éª¤4', 'success');
                        document.getElementById('step4Btn').disabled = false;
                    } else {
                        addLog(`âŒ å€¼è¢«è‡ªåŠ¨æ”¹å˜ä¸º: "${pageElements.searchBox.value}"`, 'error');
                    }
                }, 500);
                
            } catch (error) {
                addLog('âŒ æ­¥éª¤3å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function step4TriggerEvents() {
            addLog('4ï¸âƒ£ æ­¥éª¤4ï¼šè§¦å‘è¾“å…¥äº‹ä»¶...', 'info');
            
            try {
                // è§¦å‘å¿…è¦çš„äº‹ä»¶
                const inputEvent = new Event('input', { bubbles: true });
                pageElements.searchBox.dispatchEvent(inputEvent);
                addLog('   - å·²è§¦å‘ input äº‹ä»¶', 'info');
                
                setTimeout(() => {
                    const changeEvent = new Event('change', { bubbles: true });
                    pageElements.searchBox.dispatchEvent(changeEvent);
                    addLog('   - å·²è§¦å‘ change äº‹ä»¶', 'info');
                    
                    // æ£€æŸ¥é¡µé¢çŠ¶æ€
                    setTimeout(() => {
                        if (pageElements.searchBox.value === 'book') {
                            addLog('âœ… äº‹ä»¶è§¦å‘åå€¼ä¿æŒç¨³å®š', 'success');
                            document.getElementById('step5Btn').disabled = false;
                            addLog('âœ… æ­¥éª¤4å®Œæˆï¼Œå¯ä»¥è¿›è¡Œæ­¥éª¤5', 'success');
                        } else {
                            addLog(`âŒ äº‹ä»¶è§¦å‘åå€¼å˜ä¸º: "${pageElements.searchBox.value}"`, 'error');
                        }
                    }, 500);
                    
                }, 300);
                
            } catch (error) {
                addLog('âŒ æ­¥éª¤4å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function step5ClickButton() {
            addLog('5ï¸âƒ£ æ­¥éª¤5ï¼šç‚¹å‡»æäº¤æŒ‰é’®...', 'info');
            
            try {
                addLog(`   - ç‚¹å‡»å‰æœç´¢æ¡†å€¼: "${pageElements.searchBox.value}"`, 'info');
                
                pageElements.submitButton.click();
                addLog('âœ… å·²ç‚¹å‡»æäº¤æŒ‰é’®', 'success');
                
                // ç›‘æµ‹åç»­å˜åŒ–
                let checkCount = 0;
                const checkInterval = setInterval(() => {
                    checkCount++;
                    
                    try {
                        const iframe = document.getElementById('testFrame');
                        const currentUrl = iframe.contentWindow ? iframe.contentWindow.location.href : '';
                        
                        addLog(`   - æ£€æŸ¥ ${checkCount}: URL = ${currentUrl}`, 'info');
                        
                        if (currentUrl.includes('search') || currentUrl.includes('book')) {
                            addLog('ğŸ‰ æ£€æµ‹åˆ°æœç´¢è·³è½¬æˆåŠŸï¼', 'success');
                            clearInterval(checkInterval);
                        } else if (checkCount >= 10) {
                            addLog('â° æ£€æŸ¥è¶…æ—¶ï¼Œå¯èƒ½æœªå‘ç”Ÿè·³è½¬', 'warning');
                            clearInterval(checkInterval);
                        }
                    } catch (e) {
                        addLog('   - æ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message, 'warning');
                        clearInterval(checkInterval);
                    }
                }, 1000);
                
            } catch (error) {
                addLog('âŒ æ­¥éª¤5å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            addLog('ğŸ¯ ç²¾ç¡®æ§åˆ¶è‡ªåŠ¨æœç´¢æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            addLog('ğŸ“‹ ä½¿ç”¨åˆ†æ­¥æ§åˆ¶é¿å…æ„å¤–çš„é¡µé¢é‡å®šå‘', 'warning');
            updateButtonStates();
        };
    </script>
</body>
</html>
